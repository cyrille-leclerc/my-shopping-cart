receivers:
  filelog:
    # debug
    start_at: beginning
    include: [ /path/to/fraud-detection/docs/fraud-detection-sample.log.ndjson ]
    operators:
      - type: json_parser
        body: attributes.formattedMessage
        timestamp:
          # todo handle attributes.nanoseconds
          parse_from: attributes.timestamp
          layout_type: 'epoch'
          layout: 'ms'
        severity:
          parse_from: attributes.level
        trace:
          trace_id:
            parse_from: attributes.mdc.trace_id
          span_id:
            parse_from: attributes.mdc.span_id
          trace_flags:
            parse_from: attributes.mdc.trace_flags
        scope_name:
          parse_from: attributes.loggerName
      - id: move_thread_name
        type: move
        from: attributes.threadName
        to: attributes.thread.name
      - id: move_throwable_class_name
        type: move
        if: "attributes.throwable?.className != nil"
        from: attributes.throwable.className
        to: attributes.exception.type
      - id: move_throwable_message
        type: move
        if: "attributes.throwable?.message != nil"
        from: attributes.throwable.message
        to: attributes.exception.message
      # FIXME handle stack trace
      - id: remove_throwable_stack_trace
        type: remove
        if: "attributes.throwable?.stepArray != nil"
        field: attributes.throwable.stepArray
      - id: remove_logger_name
        type: remove
        field: attributes.loggerName
      - id: remove_timestamp
        type: remove
        field: attributes.timestamp
      - id: remove_level
        type: remove
        field: attributes.level
      - id: remove_span_id
        type: remove
        field: attributes.mdc.span_id
      - id: remove_trace_id
        type: remove
        field: attributes.mdc.trace_id
      - id: remove_trace_flags
        type: remove
        field: attributes.mdc.trace_flags
      - id: remove_context
        type: remove
        field: attributes.context
      - id: remove_formatted_message
        type: remove
        field: attributes.formattedMessage
      - type: stdout

processors:

exporters:
  debug:
    verbosity: detailed

service:
  pipelines:
    logs:
      receivers: [filelog]
      processors: []
      exporters: [debug]
  telemetry:
    metrics:
      level: none